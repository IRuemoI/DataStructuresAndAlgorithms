# [æ’åºæ€»ç»“ã€é“¾è¡¨ç›¸å…³é¢˜ç›®](https://www.bilibili.com/video/BV1KdvaeEEPU)

**é“¾è¡¨**

é¢è¯•é“¾è¡¨é—®é¢˜çš„è§£é¢˜æ–¹æ³•è®º

1. å¯¹äºç¬”è¯•ï¼Œä¸ç”¨å¤ªåœ¨ä¹ç©ºé—´å¤æ‚åº¦ï¼Œä¸€åˆ‡ä¸ºäº†æ—¶é—´å¤æ‚åº¦ã€‚
2. å¯¹äºé¢è¯•ï¼Œæ—¶é—´å¤æ‚åº¦ä¾ç„¶æ”¾åœ¨ç¬¬ä¸€ä½ã€‚ä½†æ˜¯ä¸€å®šè¦æ‰¾åˆ°ç©ºé—´æœ€çœçš„æ–¹æ³•ã€‚

## å¿«æ…¢æŒ‡é’ˆ

*  è¾“å…¥é“¾è¡¨å¤´èŠ‚ç‚¹,å¥‡æ•°é•¿åº¦è¿”å›ä¸­ç‚¹,å¶æ•°é•¿åº¦è¿”å›ä¸Šä¸­ç‚¹

~~~ C#
//è¿”å›é“¾è¡¨ä¸­ç‚¹æˆ–è€…ä¸Šä¸­ç‚¹
private static Node? MidOrUpMidNode(Node? head)
{
    if (head?.Next?.Next == null) return head; //å¦‚æœè¿™ä¸ªé“¾è¡¨çš„é•¿åº¦å°äº3é‚£ä¹ˆè¿”å›å¤´èŠ‚ç‚¹

    var slow = head.Next; //å®šä¹‰æ…¢æŒ‡é’ˆå¹¶å‘åç§»åŠ¨ä¸€æ¬¡
    var fast = head.Next.Next; //å®šä¹‰å¿«æŒ‡é’ˆå¹¶å‘åç§»åŠ¨ä¸€æ¬¡
    while (fast.Next is { Next: not null })
    {
        //ä¸‹ä¸€ä¸ªèŠ‚ç‚¹å’Œä¸‹ä¸¤ä¸ªèŠ‚ç‚¹ä¸ä¸ºç©º
        slow = slow?.Next; //æ…¢æŒ‡é’ˆå‘åç§»åŠ¨
        fast = fast.Next.Next; //å¿«æŒ‡é’ˆå‘åç§»åŠ¨
    }

    return slow;
}
~~~

*  è¾“å…¥é“¾è¡¨å¤´èŠ‚ç‚¹,å¥‡æ•°é•¿åº¦è¿”å›ä¸­ç‚¹,å¶æ•°é•¿åº¦è¿”å›ä¸‹ä¸­ç‚¹

~~~ C#
//è¿”å›é“¾è¡¨ä¸­ç‚¹æˆ–è€…ä¸‹ä¸­ç‚¹
private static Node? MidOrDownMidNode(Node? head)
{
    if (head?.Next == null) return head; //å¦‚æœè¿™ä¸ªé“¾è¡¨çš„é•¿åº¦å°äº2é‚£ä¹ˆè¿”å›å¤´èŠ‚ç‚¹

    //è¦æ‰¾ä¸­ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹éœ€è¦å®šä¹‰æ—¶å‘åç§»ä¸€ä¸ªèŠ‚ç‚¹
    var slow = head.Next; //å®šä¹‰æ…¢æŒ‡é’ˆ
    var fast = head.Next; //å®šä¹‰å¿«æŒ‡é’ˆ
    while (fast.Next is { Next: not null })
    {
        //ä¸‹ä¸€ä¸ªèŠ‚ç‚¹å’Œä¸‹ä¸¤ä¸ªèŠ‚ç‚¹ä¸ä¸ºç©º
        slow = slow?.Next; //æ…¢æŒ‡é’ˆå‘åç§»åŠ¨
        fast = fast.Next.Next; //å¿«æŒ‡é’ˆå‘åç§»åŠ¨
    }

    return slow;
}
~~~

*  è¾“å…¥é“¾è¡¨å¤´èŠ‚ç‚¹,å¥‡æ•°é•¿åº¦è¿”å›ä¸­ç‚¹å‰ä¸€ä¸ª,å¶æ•°é•¿åº¦è¿”å›ä¸Šä¸­ç‚¹å‰ä¸€ä¸ª

~~~ C#
//è¿”å›é“¾è¡¨ä¸­ç‚¹æˆ–è€…ä¸Šä¸­ç‚¹çš„ä¸Šä¸€ä¸ªèŠ‚ç‚¹
private static Node? MidOrUpMidPreNode(Node? head)
{
    if (head?.Next?.Next == null) return null; //å¦‚æœè¿™ä¸ªé“¾è¡¨çš„é•¿åº¦å°äº3é‚£ä¹ˆè¿”å›å¤´èŠ‚ç‚¹

    //è¦æ‰¾ä¸­ç‚¹çš„ä¸Šä¸€ä¸ªèŠ‚ç‚¹éœ€è¦å¿«å®šä¹‰æ—¶å—æŒ‡é’ˆå…ˆèµ°ä¸€æ­¥
    var slow = head; //å®šä¹‰æ…¢æŒ‡é’ˆ
    var fast = head.Next.Next; //å®šä¹‰å¿«æŒ‡é’ˆ
    while (fast.Next is { Next: not null })
    {
        //ä¸‹ä¸€ä¸ªèŠ‚ç‚¹å’Œä¸‹ä¸¤ä¸ªèŠ‚ç‚¹ä¸ä¸ºç©º
        slow = slow?.Next; //æ…¢æŒ‡é’ˆå‘åç§»åŠ¨
        fast = fast.Next.Next; //å—æŒ‡é’ˆå‘åç§»åŠ¨
    }

    return slow;
}
~~~

*  è¾“å…¥é“¾è¡¨å¤´èŠ‚ç‚¹,å¥‡æ•°é•¿åº¦è¿”å›ä¸­ç‚¹å‰ä¸€ä¸ª,å¶æ•°é•¿åº¦è¿”å›ä¸‹ä¸­ç‚¹å‰ä¸€ä¸ª

~~~ C#
//è¿”å›é“¾è¡¨ä¸­ç‚¹æˆ–è€…ä¸‹ä¸­ç‚¹çš„ä¸Šä¸€ä¸ªèŠ‚ç‚¹
private static Node? MidOrDownMidPreNode(Node? head)
{
    if (head?.Next == null) return null; //å¦‚æœè¿™ä¸ªé“¾è¡¨çš„é•¿åº¦å°äº2é‚£ä¹ˆè¿”å›ç©º

    if (head.Next.Next == null) return head; //å¦‚æœè¿™ä¸ªé“¾è¡¨çš„é•¿åº¦å°äº3é‚£ä¹ˆè¿”å›å¤´èŠ‚ç‚¹

    //è¦æ‰¾ä¸­ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹éœ€è¦å¿«å®šä¹‰æ—¶å¿«æŒ‡é’ˆå°‘èµ°ä¸€ä¸ªèŠ‚ç‚¹
    var slow = head; //å®šä¹‰æ…¢æŒ‡é’ˆ
    var fast = head.Next; //å®šä¹‰å¿«æŒ‡é’ˆ
    while (fast.Next is { Next: not null })
    {
        //ä¸‹ä¸€ä¸ªèŠ‚ç‚¹å’Œä¸‹ä¸¤ä¸ªèŠ‚ç‚¹ä¸ä¸ºç©º
        slow = slow?.Next; //æ…¢æŒ‡é’ˆå‘åç§»åŠ¨
        fast = fast.Next.Next; //å—æŒ‡é’ˆå‘åç§»åŠ¨
    }

    return slow;
}
~~~

### å¸¸è§é¢è¯•é¢˜

é¢˜ç›®æè¿°ï¼šç»™å®šä¸€ä¸ªå•é“¾è¡¨çš„å¤´èŠ‚ç‚¹Headï¼Œè¯·åˆ¤æ–­è¯¥é“¾è¡¨æ˜¯å¦ä¸ºå›æ–‡ç»“æ„ï¼Ÿ 

* ä½¿ç”¨æ ˆï¼ˆç¬”è¯•ç”¨ï¼‰

~~~ C#
// éœ€è¦O(n)çš„é¢å¤–ç©ºé—´
private static bool IsPalindrome1(Node? head)
{
    var stack = new Stack<Node>();
    var current = head;
    //å°†é“¾è¡¨çš„æ‰€æœ‰èŠ‚ç‚¹æ”¾å…¥æ ˆä¸­
    while (current != null)
    {
        stack.Push(current);
        current = current.Next;
    }

    //ä»å¤´é‡æ–°éå†é“¾è¡¨å¹¶åŒæ—¶å¼¹å‡ºæ ˆä¸­èŠ‚ç‚¹ï¼Œå¦‚æœä¸ç›¸åŒé‚£ä¹ˆä¸æ˜¯å›æ–‡
    while (head != null)
    {
        if (head.Value != stack.Pop().Value) return false;
        head = head.Next;
    }

    return true; //å…¨éƒ¨ç›¸åŒé‚£ä¹ˆå°±æ˜¯å›æ–‡
}

// éœ€è¦O(n/2)çš„é¢å¤–ç©ºé—´
private static bool IsPalindrome2(Node? head)
{
    if (head?.Next == null) return true; //é“¾è¡¨åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å›æ–‡

    //æ‰¾åˆ°é“¾è¡¨çš„ä¸‹ä¸­ç‚¹middle
    var middle = head.Next;
    var current = head;
    while (current.Next is { Next: not null })
    {
        middle = middle?.Next;
        current = current.Next.Next;
    }

    //å°†ä¸‹ä¸­ç‚¹ä¹‹åçš„èŠ‚ç‚¹æ”¾å…¥æ ˆä¸­
    var stack = new Stack<Node>();
    while (middle != null)
    {
        stack.Push(middle);
        middle = middle.Next;
    }

    //ä»å¤´é‡æ–°éå†é“¾è¡¨å¹¶åŒæ—¶å¼¹å‡ºæ ˆä¸­èŠ‚ç‚¹ï¼Œå¦‚æœä¸ç›¸åŒé‚£ä¹ˆä¸æ˜¯å›æ–‡
    while (stack.Count != 0)
    {
        if (head?.Value != stack.Pop().Value) return false;
        head = head.Next;
    }

    return true; //é“¾è¡¨çš„å‰åä¸¤éƒ¨åˆ†å¯¹ç§°æ˜¯å›æ–‡
}
~~~

* æ”¹åŸé“¾è¡¨çš„æ–¹æ³•å°±éœ€è¦æ³¨æ„è¾¹ç•Œäº†ã€‚ï¼ˆé¢è¯•ç”¨ï¼‰

æ€è·¯ï¼šç¬¬ä¸€è¶Ÿéå†å°†ä¸Šä¸­ç‚¹ä¹‹åçš„æ‰€æœ‰èŠ‚ç‚¹éƒ½æŒ‡å‘ä¸Šä¸€ä¸ªèŠ‚ç‚¹ã€‚ä¸Šä¸­ç‚¹æŒ‡å‘ç©ºï¼Œç¬¬äºŒééå†ä»ä¸¤ä¾§å‘ä¸­é—´éå†ï¼Œç›´åˆ°å®Œæˆæ£€æŸ¥ã€‚å¦‚æœ‰éœ€è¦å°†å³ä¾§æ›´æ”¹è¿‡çš„æŒ‡é’ˆæœå‘æ¢å¤ã€‚

~~~ C#
// éœ€è¦O(1)çš„é¢å¤–ç©ºé—´    
public static bool IsPalindrome3(Node? head)
{
    if (head?.Next == null) return true;

    // æ‰¾åˆ°é“¾è¡¨çš„ä¸‹ä¸­ç‚¹middle
    var middle = head;
    var current = head;
    while (current.Next is { Next: not null })
    {
        middle = middle?.Next;
        current = current.Next.Next;
    }

    current = middle?.Next; //currentæŒ‡å‘å³åŠéƒ¨åˆ†çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ 
    var preNode = middle;
    if (middle != null)
    {
        //ç¿»è½¬é“¾è¡¨å³åŠéƒ¨åˆ†
        middle.Next = null; //å°†é“¾è¡¨ä»ä¸­é—´æ–­å¼€ 
        while (current != null)
        {
            //å³åŠéƒ¨åˆ†ç¿»è½¬
            var nextNode = current.Next; //è®°å½•ä¸‹ä¸ªèŠ‚ç‚¹ 
            current.Next = preNode; //å½“å‰èŠ‚ç‚¹çš„NextæŒ‡å‘å‰ä¸€ä¸ªèŠ‚ç‚¹
            preNode = current; //ä¸Šä¸ªèŠ‚ç‚¹åç§»
            current = nextNode; //å½“å‰èŠ‚ç‚¹åç§»
        }

        var leftHead = head; //è·å–å·¦ä¾§çš„å¤´æŒ‡é’ˆ
        var rightHead = preNode; //è·å–å³ä¾§çš„å¤´æŒ‡é’ˆ
        var result = true;
        while (leftHead != null && rightHead != null)
        {
            //åˆ¤æ–­å›æ–‡
            if (leftHead.Value != rightHead.Value)
            {
                result = false;
                break;
            }

            //ä¸¤ç«¯æŒ‡é’ˆå‘ä¸­é—´ç§»åŠ¨
            leftHead = leftHead.Next;
            rightHead = rightHead.Next;
        }

        // é‡æ–°è¿æ¥å¹¶æ¢å¤ååŠéƒ¨åˆ†é“¾è¡¨çš„é¡ºåº
        var tail = preNode; //å³åŠéƒ¨åˆ†çš„å¤´èŠ‚ç‚¹
        var currentNode = preNode?.Next; //è®¾ç½®å³åŠéƒ¨åˆ†çš„ç¬¬äºŒä¸ªèŠ‚ç‚¹ä¸ºå½“å‰èŠ‚ç‚¹
        tail!.Next = null; //å°†å³åŠéƒ¨åˆ†çš„å¤´èŠ‚ç‚¹è®¾ç½®ä¸ºç©º
        while (currentNode != null)
        {
            var nextNode = currentNode.Next; //è·å–å³ä¾§çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
            currentNode.Next = preNode; //å°†å½“å‰èŠ‚ç‚¹çš„NextæŒ‡å‘å‰ä¸€ä¸ªèŠ‚ç‚¹
            preNode = currentNode; //å‰ä¸€ä¸ªèŠ‚ç‚¹åç§»
            currentNode = nextNode; //å½“å‰èŠ‚ç‚¹åç§»
        }

        return result;
    }

    throw new InvalidOperationException();
}
~~~

é¢˜ç›®æè¿°ï¼šé•¿åº¦ç›¸åŒçš„ä¸¤ä¸ªé“¾è¡¨ï¼Œè¦æ±‚ç¬¬äºŒä¸ªé“¾è¡¨ç¿»è½¬åï¼Œä¸¤é“¾è¡¨äº¤é”™è¿æˆä¸€ä¸ªæ–°çš„é“¾è¡¨ï¼Œè¿”å›æ–°é“¾è¡¨çš„å¤´èŠ‚ç‚¹ã€‚

~~~ C#
//TODO:è¿™ä¸ªè¿˜æ²¡æµ‹è¯•è¿‡
public ListNode MergeAndReverse(ListNode l1, ListNode l2)
{
    if (l1 == null || l2 == null) return l1 ?? l2;

    // ç¿»è½¬ç¬¬äºŒä¸ªé“¾è¡¨
    ListNode prev = null;
    ListNode current = l2;
    ListNode next = null;
    while (current != null)
    {
        next = current.next;
        current.next = prev;
        prev = current;
        current = next;
    }
    l2 = prev; // æ­¤æ—¶l2æŒ‡å‘ç¿»è½¬åçš„é“¾è¡¨å¤´

    // äº¤é”™è¿æ¥ä¸¤ä¸ªé“¾è¡¨
    ListNode dummy = new ListNode(0);
    ListNode tail = dummy;
    bool useL1 = true;
    while (l1 != null && l2 != null)
    {
        if (useL1)
        {
            tail.next = l1;
            l1 = l1.next;
        }
        else
        {
            tail.next = l2;
            l2 = l2.next;
        }
        tail = tail.next;
        useL1 = !useL1; // äº¤æ›¿ä½¿ç”¨l1å’Œl2
    }

    // å¦‚æœé“¾è¡¨é•¿åº¦ä¸ä¸€è‡´ï¼Œç›´æ¥è¿æ¥å‰©ä½™éƒ¨åˆ†
    tail.next = l1 ?? l2;

    return dummy.next;
}
~~~

é¢˜ç›®æè¿°ï¼šå°†å•é“¾è¡¨æŒ‰ç…§æŸå€¼åˆ’åˆ†æˆå·¦è¾¹å˜å°ã€ä¸­é—´ç›¸ç­‰ã€å³è¾¹å¤§çš„å½¢å¼ã€‚

æ€è·¯ï¼šå‚è€ƒSmallerEqualBigger

* æŠŠé“¾è¡¨æ”¾å…¥åˆ°æ•°ç»„ä¸­ï¼Œåœ¨æ•°ç»„ä¸ŠåšPartionï¼ˆç¬”è¯•ï¼‰

~~~ C#
private static Node? ListPartition1(Node? head, int target)
{
    if (head == null) return head; //ç©ºé“¾è¡¨ç›´æ¥è¿”å›

    //è·å¾—é“¾è¡¨çš„é•¿åº¦
    var current = head;
    var length = 0;
    while (current != null)
    {
        length++;
        current = current.Next;
    }

    //å°†é“¾è¡¨ä¸­çš„èŠ‚ç‚¹æ”¾åˆ°æ•°ç»„ä¸­
    var nodeArray = new Node?[length];
    current = head;
    for (length = 0; length != nodeArray.Length; length++)
    {
        nodeArray[length] = current;
        current = current?.Next;
    }

    //å¯¹æ•°ç»„è¿›è¡Œåˆ’åˆ†
    ArrayPartition(nodeArray, target);
    //æŠŠæ•°ç»„ä¸­çš„èŠ‚ç‚¹ä»å·¦å‘å³é‡æ–°è¿æ¥å¹¶å°†æœ€åä¸€ä¸ªèŠ‚ç‚¹çš„Nextè®¾ç½®ä¸ºnull
    for (length = 1; length != nodeArray.Length; length++) nodeArray[length - 1]!.Next = nodeArray[length];
    nodeArray[length - 1]!.Next = null;
    //è¿”å›å¤´æŒ‡é’ˆ
    return nodeArray[0];
}

private static void ArrayPartition(Node?[] nodeArr, int target)
{
    var small = -1;
    var big = nodeArr.Length;
    var index = 0;
    while (index != big)
    {
        if (nodeArr[index]?.Value < target)
        {
            small++;
            (nodeArr[small], nodeArr[index]) = (nodeArr[index], nodeArr[small]);
            index++;
        }
        else if (nodeArr[index]?.Value == target)
        {
            index++;
        }
        else
        {
            big--;
            (nodeArr[big], nodeArr[index]) = (nodeArr[index], nodeArr[big]);
        }
    }
}
~~~

* åˆ†æˆå¤§ä¸­å°ä¸‰ä¸ªéƒ¨åˆ†ï¼Œå†æŠŠå„ä¸ªéƒ¨åˆ†ä¸²èµ·æ¥ï¼ˆé¢è¯•ï¼‰

~~~ C#
private static Node? ListPartition2(Node? head, int target)
{
    Node? lessRegionHead = null; //å°äºåŒºåŸŸå¤´æŒ‡é’ˆ
    Node? lessRegionTail = null; //å°äºåŒºåŸŸå°¾æŒ‡é’ˆ
    Node? equalRegionHead = null; //ç­‰äºåŒºåŸŸå¤´æŒ‡é’ˆ
    Node? equalRegionTail = null; //ç­‰äºåŒºåŸŸå°¾æŒ‡é’ˆ
    Node? greaterRegionHead = null; //å¤§äºåŒºåŸŸå¤´æŒ‡é’ˆ
    Node? greaterRegionTail = null; //å¤§äºåŒºåŸŸå°¾æŒ‡é’ˆ
    // å°†æ¯ä¸ªèŠ‚ç‚¹åˆ†é…åˆ°ä¸‰ä¸ªåŒºåŸŸä¸­
    var current = head;
    while (current != null)
    {
        var next = current.Next; //ä¿å­˜å½“å‰èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
        current.Next = null; //å°†å½“å‰èŠ‚ç‚¹çš„äºä¹‹åçš„èŠ‚ç‚¹æ–­å¼€
        if (current.Value < target) //å°äºåŒºåŸŸ
        {
            if (lessRegionHead == null) //å°äºåŒºåŸŸä¸ºç©º
            {
                //å°äºåŒºåŸŸçš„å¤´å°¾æŒ‡é’ˆéƒ½æŒ‡å‘è¿™ä¸ªèŠ‚ç‚¹
                lessRegionHead = current;
                lessRegionTail = current;
            }
            else
            {
                //åœ¨å°äºåŒºåŸŸçš„å°¾æŒ‡é’ˆæŒ‡å‘çš„èŠ‚ç‚¹åè¿½åŠ è¿™ä¸ªæ–°èŠ‚ç‚¹å¹¶æ›´æ–°å°¾æŒ‡é’ˆ
                if (lessRegionTail != null) lessRegionTail.Next = current;
                lessRegionTail = current;
            }
        }
        else if (current.Value == target) //ç­‰äºåŒºåŸŸ
        {
            if (equalRegionHead == null) //ç­‰äºåŒºåŸŸä¸ºç©º
            {
                //ç­‰äºåŒºåŸŸçš„å¤´å°¾æŒ‡é’ˆéƒ½æŒ‡å‘è¿™ä¸ªèŠ‚ç‚¹
                equalRegionHead = current;
                equalRegionTail = current;
            }
            else
            {
                //åœ¨ç­‰äºåŒºåŸŸçš„å°¾æŒ‡é’ˆæŒ‡å‘çš„èŠ‚ç‚¹åè¿½åŠ è¿™ä¸ªæ–°èŠ‚ç‚¹å¹¶æ›´æ–°å°¾æŒ‡é’ˆ
                if (equalRegionTail != null) equalRegionTail.Next = current;
                equalRegionTail = current;
            }
        }
        else //å¤§äºåŒºåŸŸ
        {
            if (greaterRegionHead == null) //å¤§äºåŒºåŸŸä¸ºç©º
            {
                //å¤§äºåŒºåŸŸçš„å¤´å°¾æŒ‡é’ˆéƒ½æŒ‡å‘è¿™ä¸ªèŠ‚ç‚¹
                greaterRegionHead = current;
                greaterRegionTail = current;
            }
            else
            {
                //åœ¨å¤§äºåŒºåŸŸçš„å°¾æŒ‡é’ˆæŒ‡å‘çš„èŠ‚ç‚¹åè¿½åŠ è¿™ä¸ªæ–°èŠ‚ç‚¹å¹¶æ›´æ–°å°¾æŒ‡é’ˆ
                if (greaterRegionTail != null) greaterRegionTail.Next = current;
                greaterRegionTail = current;
            }
        }

        current = next;
    }

    // å°äºåŒºåŸŸçš„å°¾å·´ï¼Œè¿ç­‰äºåŒºåŸŸçš„å¤´ï¼Œç­‰äºåŒºåŸŸçš„å°¾å·´è¿å¤§äºåŒºåŸŸçš„å¤´
    if (lessRegionTail != null) // å¦‚æœæœ‰å°äºåŒºåŸŸ
    {
        lessRegionTail.Next = equalRegionHead;
        equalRegionTail ??= lessRegionTail; // å¦‚æœæ²¡æœ‰ç­‰äºåŒºåŸŸï¼Œç­‰äºåŒºåŸŸçš„å°¾æŒ‡é’ˆæŒ‡å‘å°äºåŒºåŸŸçš„å°¾æŒ‡é’ˆ
    }

    // ç­‰äºåŒºåŸŸçš„å°¾å·´ï¼Œè¿å¤§äºåŒºåŸŸçš„å¤´
    if (equalRegionTail != null) // å¦‚æœå°äºåŒºåŸŸå’Œç­‰äºåŒºåŸŸï¼Œä¸æ˜¯éƒ½æ²¡æœ‰
        equalRegionTail.Next = greaterRegionHead;

    //è¿”å›å°äºåŒºåŸŸçš„å¤´ï¼Œå¦‚æœæ²¡æœ‰å°äºåŒºåŸŸï¼Œè¿”å›ç­‰äºåŒºåŸŸçš„å¤´ï¼Œå¦‚æœæ²¡æœ‰ç­‰äºåŒºåŸŸï¼Œè¿”å›å¤§äºåŒºåŸŸçš„å¤´
    return lessRegionHead ?? (equalRegionHead ?? greaterRegionHead);
}
~~~

é¢˜ç›®æè¿°ï¼šä¸€ç§ç‰¹æ®Šçš„å•é“¾è¡¨èŠ‚ç‚¹ç±»æè¿°å¦‚ä¸‹

~~~C#
public class Node
{
	private int _value;
	private Node _next;
	private Node _rand;
	Node(int val){_value = val}
}
~~~

randæŒ‡é’ˆæ˜¯å•é“¾è¡¨èŠ‚ç‚¹ç»“æ„ä¸­æ–°å¢çš„æŒ‡é’ˆï¼Œrandå¯èƒ½æŒ‡å‘å•é“¾è¡¨ä¸­çš„ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¹Ÿå¯èƒ½æŒ‡å‘nullï¼Œç»™å®šä¸€ä¸ªç”±NodeèŠ‚ç‚¹ç±»å‹ç»„æˆçš„æ— ç¯å•é“¾è¡¨çš„å¤´èŠ‚ç‚¹headï¼Œè¯·äº‹å…ˆä¸€ä¸ªå‡½æ•°å®Œæˆè¿™ä¸ªé“¾è¡¨çš„å¤åˆ¶ï¼Œè¯·å®ç°ä¸€ä¸ªå‡½æ•°å®Œæˆè¿™ä¸ªé“¾è¡¨çš„å¤åˆ¶ï¼Œå¹¶è¿”å›å¤åˆ¶çš„æ–°é“¾è¡¨çš„çš„å¤´èŠ‚ç‚¹ã€‚è¦æ±‚æ—¶é—´å¤æ‚åº¦$O(N)$ï¼Œç©ºé—´å¤æ‚åº¦$O(1)$ã€‚
æ€è·¯ï¼š

* ä½¿ç”¨Dict\<Node,Node\>ï¼Œç¬¬ä¸€éåªæ˜¯ç”¨åŸé“¾è¡¨çš„nextæŒ‡é’ˆè¿›è¡Œéå†ï¼Œéå†æ—¶åŒæ—¶åˆ›å»ºå‡ºå¤åˆ¶çš„èŠ‚ç‚¹ã€‚ç¬¬äºŒééå†æ—¶æ ¹æ®åŸé“¾è¡¨çš„nextå’Œrandçš„é“¾æ¥å…³ç³»å°†å¤åˆ¶çš„èŠ‚ç‚¹å•é“¾æ¥èµ·æ¥ã€‚
* ç¬¬ä¸€ééå†åœ¨åŸæ¥èŠ‚ç‚¹ä¹‹é—´æ’å…¥å¤åˆ¶çš„èŠ‚ç‚¹ã€‚ç¬¬äºŒééå†è®¾ç½®ä¸åŸæ¥ç›¸åŒçš„nextå’Œrandçš„é“¾æ¥å…³ç³»ã€‚å¹¶å°†ä¸åŸå§‹é“¾è¡¨èŠ‚ç‚¹çš„é“¾æ¥åˆ é™¤ã€‚æœ€åè¿”å›å®Œæˆå¤åˆ¶çš„æ–°é“¾è¡¨çš„å¤´èŠ‚ç‚¹ã€‚

é¢˜ç›®æè¿°ï¼šç»™å®šä¸¤ä¸ªå¯èƒ½æœ‰ç¯ä¹Ÿå¯èƒ½æ— ç¯çš„å•é“¾è¡¨,å¤´èŠ‚ç‚¹head1å’Œhead2è¯·å®ç°ä¸€ä¸ªå‡½æ•°,å¦‚æœä¸¤ä¸ªé“¾è¡¨ç›¸äº¤,è¯·è¿”å›ç›¸äº¤çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ã€‚å¦‚æœä¸ç›¸äº¤,è¿”å›nullã€‚è¦æ±‚ï¼šå¦‚æœä¸¤ä¸ªé“¾è¡¨é•¿åº¦ä¹‹å’Œä¸ºN,æ—¶é—´å¤æ‚åº¦è¯·è¾¾åˆ°$O(N)$,é¢å¤–ç©ºé—´å¤æ‚åº¦è¯·è¾¾åˆ°$O(1)$ã€‚

æ€è·¯ï¼š
* å¿«æ…¢æŒ‡é’ˆæ±‚è§£
	* éœ€è¦æ‰¾åˆ°ç¬¬ä¸€ä¸ªå…¥ç¯èŠ‚ç‚¹
	* è·å¾—å…¥ç¯èŠ‚ç‚¹å‡½æ•°ï¼šè®¾ç½®å¿«æ…¢ä¸¤ä¸ªæŒ‡é’ˆï¼Œå¿«æŒ‡é’ˆä¸€æ¬¡èµ°ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œæ…¢æŒ‡é’ˆä¸€æ¬¡èµ°ä¸€ä¸ªèŠ‚ç‚¹ï¼›è‹¥å¿«æŒ‡é’ˆå¯ä»¥åˆ°è¾¾nullï¼Œè¿™è¯´æ˜è¿™ä¸ªé“¾è¡¨æ˜¯æ— ç¯çš„ã€‚è‹¥é“¾è¡¨æ˜¯æœ‰ç¯çš„ï¼Œé‚£ä¹ˆå¿«æŒ‡é’ˆå¯ä»¥åœ¨ç¯ä¸Šçš„æŸä¸€ä¸ªèŠ‚ç‚¹ç›¸é‡ã€‚ç›¸é‡ä¹‹åï¼Œæ…¢æŒ‡é’ˆä¿æŒä¸å˜ï¼Œå¿«æŒ‡é’ˆè¿”å›é“¾è¡¨å¤´éƒ¨ï¼Œæ›´æ”¹ä¸ºæ¯æ¬¡èµ°ä¸€ä¸ªèŠ‚ç‚¹ã€‚å¿«æ…¢æŒ‡é’ˆå†æ¬¡å‘åç§»åŠ¨ï¼Œåˆ™ç›¸é‡çš„èŠ‚ç‚¹å°±æ˜¯å…¥ç¯çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ã€‚(**ä¸‹æ–¹çš„æ€è€ƒé¢˜è§£é‡Šäº†ä¸ºä»€ä¹ˆè¿™æ ·å¯ä»¥æ‰¾åˆ°å…¥ç¯èŠ‚ç‚¹**)
	* åˆ¤æ–­ä¸¤é“¾è¡¨æ˜¯å¦ç›¸äº¤å‡½æ•°ï¼šåˆ†åˆ«è·å¾—ä¸¤ä¸ªé“¾è¡¨çš„æœ«å°¾èŠ‚ç‚¹çš„åœ°å€å’Œé“¾è¡¨çš„é•¿åº¦ã€‚å¦‚æœä¸¤ä¸ªé“¾è¡¨çš„æœ«å°¾èŠ‚ç‚¹åœ°å€ä¸ç›¸åŒï¼Œåˆ™ä¸¤é“¾è¡¨ä¸ç›¸äº¤ã€‚è‹¥æœ«å°¾èŠ‚ç‚¹åœ°å€ç›¸åŒï¼Œè¾ƒé•¿çš„é“¾è¡¨å…ˆå‘åç§»åŠ¨ä¸¤é“¾è¡¨ç›¸å·®çš„é•¿åº¦ã€‚ç„¶åä¸¤é“¾è¡¨åŒæ—¶å‘åç§»åŠ¨ã€‚åˆ™ä¸¤æŒ‡é’ˆç¬¬ä¸€ä¸ªåŒæ—¶æŒ‡å‘çš„èŠ‚ç‚¹å°±æ˜¯ä¸¤é“¾è¡¨ç›¸äº¤çš„èŠ‚ç‚¹ã€‚
	* å¯èƒ½å‡ºç°çš„æ‰€æœ‰æƒ…å†µï¼š
	<img src="./Assets/EP09_01.jpg" alt="æ‰€æœ‰çš„æƒ…å†µ" style="zoom: 33%;" />
	* ä¸¤ä¸ªé“¾è¡¨éƒ½æ— ç¯(å¯èƒ½ç›¸äº¤åˆèƒ½ä¸ç›¸äº¤â€œæƒ…å†µ1â€å’Œâ€œæƒ…å†µ2â€)
	* ä¸¤é“¾è¡¨ä¸­æœ‰ä¸€ä¸ªæ˜¯æœ‰ç¯çš„(ä¸å¯èƒ½ç›¸äº¤â€œæƒ…å†µ3â€)
	* ä¸¤ä¸ªé“¾è¡¨éƒ½æœ‰ç¯(å¯èƒ½ç›¸äº¤â€œæƒ…å†µ4â€å’Œâ€œæƒ…å†µ5â€ï¼Œå¯èƒ½ä¸ç›¸äº¤â€œæƒ…å†µ6â€)
	

~~~ C#
private static Node? GetIntersectNode(Node? head1, Node? head2)
{
    if (head1 == null || head2 == null) return null;

    //è·å–ä¸¤ä¸ªé“¾è¡¨çš„å…¥ç¯èŠ‚ç‚¹
    var loop1 = GetLoopNode(head1);
    var loop2 = GetLoopNode(head2);
    //å¦‚æœä¸¤ä¸ªé“¾è¡¨çš„å…¥ä¼™èŠ‚ç‚¹ä¸€è‡´ï¼ŒæŒ‰ç…§ä¸¤é“¾è¡¨ç›¸äº¤å¹¶æ— ç¯çš„è¯·æƒ…å†µå¤„ç†
    if (loop1 == null && loop2 == null) return NoLoop(head1, head2);

    //å¦‚æœä¸¤ä¸ªé“¾è¡¨éƒ½æœ‰å…¥ç¯èŠ‚ç‚¹ï¼ŒæŒ‰ç…§ä¸¤é“¾è¡¨ç›¸äº¤æœ‰ç¯çš„è¯·æƒ…å†µå¤„ç†
    if (loop1 != null && loop2 != null) return BothLoop(head1, loop1, head2, loop2);

    //å¦‚æœä¸¤ä¸ªé“¾è¡¨ä¸€ä¸ªæœ‰å…¥ç¯èŠ‚ç‚¹ï¼Œä¸€ä¸ªæ²¡æœ‰å…¥ç¯èŠ‚ç‚¹ï¼Œåˆ™ä¸¤é“¾è¡¨ä¸ç›¸äº¤
    return null;
}

// æ‰¾åˆ°é“¾è¡¨çš„å…¥ç¯èŠ‚ç‚¹ï¼Œå¦‚æœæ— ç¯ï¼Œè¿”å›nullã€‚å…³äºè¿™ä¸ªå‡½æ•°çš„åŸç†ï¼Œç¬”è®°EP09ä¸­æœ‰è¯´æ˜
private static Node? GetLoopNode(Node? head)
{
    if (head?.Next?.Next == null) return null;

    var slow = head.Next;
    var fast = head.Next.Next;
    while (slow != fast)
    {
        if (fast.Next?.Next == null) return null;

        fast = fast.Next.Next;
        slow = slow?.Next;
    }

    fast = head;
    while (slow != fast)
    {
        slow = slow?.Next;
        fast = fast?.Next;
    }

    return slow;
}

// å¦‚æœä¸¤ä¸ªé“¾è¡¨éƒ½æ— ç¯ï¼Œè¿”å›ç¬¬ä¸€ä¸ªç›¸äº¤èŠ‚ç‚¹ï¼Œå¦‚æœä¸æƒ³äº¤ï¼Œè¿”å›null
private static Node? NoLoop(Node? head1, Node? head2)
{
    if (head1 == null || head2 == null) return null;

    var cur1 = head1;
    var cur2 = head2;
    var lengthGap = 0;
    while (cur1.Next != null)
    {
        lengthGap++;
        cur1 = cur1.Next;
    }

    while (cur2.Next != null)
    {
        lengthGap--;
        cur2 = cur2.Next;
    }

    if (cur1 != cur2) return null;

    cur1 = lengthGap > 0 ? head1 : head2; // è°é•¿ï¼Œè°çš„å¤´å˜æˆcur1
    cur2 = cur1 == head1 ? head2 : head1; // è°çŸ­ï¼Œè°çš„å¤´å˜æˆcur2
    lengthGap = Math.Abs(lengthGap);
    //è®©é•¿é“¾è¡¨çš„currentæŒ‡é’ˆå…ˆèµ°lengthGapæ­¥
    while (lengthGap != 0)
    {
        lengthGap--;
        cur1 = cur1?.Next;
    }

    //ä¸¤ä¸ªé“¾è¡¨currentæŒ‡é’ˆåŒæ—¶èµ°ï¼Œå¦‚æœç›¸äº¤ï¼Œåˆ™è¿”å›ç¬¬ä¸€ä¸ªç›¸äº¤èŠ‚ç‚¹
    while (cur1 != cur2)
    {
        cur1 = cur1?.Next;
        cur2 = cur2?.Next;
    }

    //å¦‚æœä¸æƒ³äº¤ï¼Œcur1ä¸ºnull
    return cur1;
}

// ä¸¤ä¸ªæœ‰ç¯é“¾è¡¨ï¼Œè¿”å›ç¬¬ä¸€ä¸ªç›¸äº¤èŠ‚ç‚¹ï¼Œå¦‚æœä¸æƒ³äº¤è¿”å›null
private static Node? BothLoop(Node head1, Node loop1, Node head2, Node loop2)
{
    Node? cur1;
    //å¦‚æœä¸¤ä¸ªå…¥ç¯èŠ‚ç‚¹ä¸€è‡´ï¼Œè¯´æ˜æ­¤æ—¶ä¸¤é“¾è¡¨å‘ˆ>-Oï¼ŒæŒ‰ç…§>-å¤„ç†ï¼Œåªä¸è¿‡ä»–çš„æœ«å°¾èŠ‚ç‚¹å˜æˆäº†loop1æˆ–è€…loop2
    if (loop1 == loop2)
    {
        cur1 = head1;
        var cur2 = head2;
        var n = 0;
        while (cur1 != loop1)
        {
            n++;
            cur1 = cur1?.Next;
        }

        while (cur2 != loop2)
        {
            n--;
            cur2 = cur2?.Next;
        }

        cur1 = n > 0 ? head1 : head2;
        cur2 = cur1 == head1 ? head2 : head1;
        n = Math.Abs(n);
        while (n != 0)
        {
            n--;
            cur1 = cur1?.Next;
        }

        while (cur1 != cur2)
        {
            cur1 = cur1?.Next;
            cur2 = cur2?.Next;
        }

        return cur1;
    }

    //å¦‚æœä¸¤ä¸ªå…¥ç¯èŠ‚ç‚¹èƒ½å‘åç§»åŠ¨é‡åˆ°å¦ä¸ªå…¥ç¯èŠ‚ç‚¹ï¼Œè¯´æ˜æ­¤æ—¶ä¸¤é“¾è¡¨å‘ˆğŸ˜ˆ(åœ†ä¸Šä¸¤ä¸ªè§¦è§’)
    cur1 = loop1.Next;
    while (cur1 != loop1)
    {
        if (cur1 == loop2) return loop1;

        cur1 = cur1?.Next;
    }

    //ä¸¤ä¸ªé“¾è¡¨æœ‰ç¯ä½†ä¸ç›¸äº¤
    return null;
}
~~~~

* å®¹å™¨æ±‚è§£ï¼šä½¿ç”¨é›†åˆç»Ÿè®¡

~~~ C#
private static Node? GetIntersectNode(Node? head1, Node? head2)
{
    ISet<Node> visited = new HashSet<Node>();//è®°å½•é“¾è¡¨Aä¸­è®¿é—®è¿‡çš„èŠ‚ç‚¹
    //å°†è®¿é—®è¿‡çš„é“¾è¡¨æ”¾å…¥é›†åˆä¸­
    var temp = head1;
    while (temp != null)
    {
        //å¦‚æœæ·»åŠ äº†é‡å¤çš„èŠ‚ç‚¹è¯´æ˜å·²ç»å°†ç¯ä¸Šçš„èŠ‚ç‚¹æ·»åŠ å®Œæ¯•ï¼Œé€€å‡ºå¾ªç¯
        if(!visited.Add(temp)) break;
        temp = temp.Next;
    }

    //éå†é“¾è¡¨Bï¼Œå¦‚æœBä¸­å­˜åœ¨Aä¸­è®¿é—®è¿‡çš„èŠ‚ç‚¹ï¼Œè¿™ä¸ªèŠ‚ç‚¹å°±æ˜¯ä¸¤é“¾è¡¨ç›¸äº¤æ—¶çš„èŠ‚ç‚¹
    temp = head2;
    while (temp != null)
    {
        if (visited.Contains(temp))
        {
            return temp;
        }

        temp = temp.Next;
    }

    return null;
}
~~~~

> æ€è€ƒé¢˜ï¼šä¸ºä»€ä¹ˆå¿«æ…¢æŒ‡é’ˆèƒ½æ‰¾åˆ°ç¬¬ä¸€ä¸ªå…¥ç¯çš„èŠ‚ç‚¹ï¼Ÿ

ç°åœ¨æˆ‘ä»¬æœ‰ä¸€ä¸ªç¡®å®šåŒ…å«ç¯çš„å•é“¾è¡¨ï¼Œå¹¶æä¾›å®ƒçš„å¤´èŠ‚ç‚¹æŒ‡é’ˆheadã€‚å•é“¾è¡¨çš„å°¾èŠ‚ç‚¹çš„NextæŒ‡é’ˆå…·ä½“æŒ‡å‘äº†åˆ—è¡¨ä¸­çš„å“ªä¸€ä¸ªèŠ‚ç‚¹æˆ‘ä»¬æ˜¯æš‚æ—¶ä¸çŸ¥é“çš„ã€‚

ç°åœ¨æˆ‘ä»¬è§„å®šå¤´èŠ‚åˆ°è¾¾ç¯çš„å…¥å£èŠ‚ç‚¹çš„é•¿åº¦ä¸ºLï¼Œç¯å†…çš„èŠ‚ç‚¹æ•°ä¸ºCï¼Œå…¥å£èŠ‚ç‚¹åˆ°å¿«æ…¢æŒ‡é’ˆç›¸é‡çš„èŠ‚ç‚¹nodeçš„è·ç¦»ä¸ºXã€‚æ­¤æ—¶ï¼Œæ…¢æŒ‡é’ˆä»å¤´èŠ‚ç‚¹åˆ°ç°åœ¨èµ°è¿‡çš„è·¯ç¨‹ä¸º$L+X$ã€‚å¿«æŒ‡é’ˆèµ°è¿‡çš„è·¯ç¨‹æ˜¯LåŠ ä¸Šä¸çŸ¥é“å¤šå°‘åœˆçš„ç¯å†åŠ ä¸ŠXå³$L+n\times C+X$ã€‚æˆ‘ä»¬çŸ¥é“å¿«æŒ‡é’ˆçš„ç§»åŠ¨é€Ÿåº¦æ˜¯æ…¢æŒ‡é’ˆçš„ä¸¤å€ï¼Œæ‰€ä»¥å°±æœ‰$2\times (L+X)=L+n\times C+X$ï¼ŒåŒ–ç®€åå¾—åˆ°$L+X=n\times C$â€‹ã€‚æ ¹æ®è¿™ä¸ªåŒ–ç®€åçš„è¡¨è¾¾å¼æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼šå½“å‰å·²ç»ä»å…¥å£èŠ‚ç‚¹å‘åç§»åŠ¨äº†Xä¸ªèŠ‚ç‚¹çš„æ…¢æŒ‡é’ˆå¦‚æœå†ç»§ç»­å‘åç§»åŠ¨Lä¸ªèŠ‚ç‚¹é‚£ä¹ˆæ…¢æŒ‡é’ˆå°±èµ°äº†nåœˆçš„ç¯ï¼Œé‚£ä¹ˆå°±å›åˆ°äº†ç¯çš„èµ·ç‚¹ã€‚ä¸”è¿™ä¸ªé•¿åº¦Lå°±æ˜¯å¤´èŠ‚ç‚¹åˆ°å…¥ç¯èŠ‚ç‚¹çš„è·ç¦»ã€‚æ‰€ä»¥å¿«æŒ‡é’ˆä»å¤´ä¸€å€çš„é€Ÿåº¦ä¸€ç›´å‘åç§»åŠ¨ï¼Œå½“å‰ä¸¤ä¸ªèŠ‚ç‚¹ç›¸é‡æ—¶ï¼Œå¿«æ…¢æŒ‡é’ˆæŒ‡å‘çš„èŠ‚ç‚¹å°±æ˜¯ç¯çš„å…¥å£èŠ‚ç‚¹ã€‚

> æ€è€ƒé¢˜ï¼šå¯¹äºä¸€ä¸ªå•é“¾è¡¨ï¼Œå¦‚æœåªçŸ¥é“è¦åˆ é™¤çš„æŸä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆåº”è¯¥å¦‚ä½•åˆ é™¤è¿™ä¸ªèŠ‚ç‚¹å‘¢ï¼Ÿè¿™æ ·åšæœ‰ä»€ä¹ˆå¼Šç«¯ï¼Ÿ

å¯¹äºåªçŸ¥é“åœ¨å•é“¾è¡¨ä¸Šè¦åˆ é™¤æŸä¸ªèŠ‚ç‚¹å¹¶å®Œæˆåˆ é™¤æ“ä½œï¼Œä¸€ä¸ªä¸å®Œç¾çš„è§£å†³æ–¹æ¡ˆæ˜¯ç”¨åé¢èŠ‚ç‚¹çš„å€¼æ¥è¦†ç›–å‰é¢èŠ‚ç‚¹çš„å€¼ã€‚ä½†æ˜¯è¿™ç§æ–¹æ³•æ— æ³•å®Œæˆé“¾è¡¨å°¾èŠ‚ç‚¹çš„åˆ é™¤æ“ä½œã€‚æ¯”å¦‚å¦‚æœé“¾è¡¨æ˜¯å¸¦æœ‰ä¾èµ–çš„æŸä¸ªä¸šåŠ¡å®ä½“ï¼Œé‚£ä¹ˆé€šè¿‡è¦†ç›–æ–¹æ³•ä¼šå› ä¸ºæ•°æ®çš„è®¿é—®æƒé™å’Œä¾èµ–è¿ç§»å›°éš¾å¯¼è‡´è¿™ç§æ–¹æ³•å¹¶ä¸å¯è¡Œã€‚
